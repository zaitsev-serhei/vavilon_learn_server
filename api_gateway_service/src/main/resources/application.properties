# API Gateway
server.port=8080
spring.application.name=api_gateway

# Consul
spring.cloud.consul.discovery.enabled=true
spring.cloud.consul.discovery.service-name=api-gateway
spring.cloud.consul.host=localhost
spring.cloud.consul.port=8500
spring.cloud.gateway.server.webflux.discovery.locator.enabled=false
spring.cloud.consul.discovery.prefer-ip-address=true
spring.main.web-application-type=reactive

# JWKS (Auth service)
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://auth-service/.well-known/jwks.json
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://auth-service

# Actuator & metrics
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.server.port=8081

#spring.cloud.gateway.server.webflux.routes
# Gateway explicit routes (new recommended properties format) for ext/int filtering
spring.cloud.gateway.server.webflux.routes[0].id=auth-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://auth-service
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/oauth2/**, /oauth2/**, /.well-known/**

spring.cloud.gateway.server.webflux.routes[1].id=user-service
spring.cloud.gateway.server.webflux.routes[1].uri=lb://user-service
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/api/users/**
spring.cloud.gateway.server.webflux.routes[1].filters[0]=StripPrefix=2
spring.cloud.gateway.server.webflux.routes[1].filters[1]=UserClaimPropagationGatewayFilter
spring.cloud.gateway.server.webflux.routes[1].filters[2]=InternalServiceTokenGatewayFilter

# Forward headers so downstream services can see original host/proto
server.forward-headers-strategy=framework

# CORS
app.frontend.allowed-origins=http://localhost:5173

# Logging
logging.level.org.springframework.web=INFO
logging.level.com.language_practice_server=DEBUG
